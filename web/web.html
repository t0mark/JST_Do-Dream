<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국 지역별 데이터 시각화</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 80px);
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
            background-color: #f8f9fa;
        }
        
        .sidebar {
            width: 300px;
            background-color: white;
            padding: 20px;
            box-shadow: -2px 0 4px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .info-panel {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .legend {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .controls {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .controls h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .control-group select, .control-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .tooltip {
            background-color: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        /* Leaflet 컨트롤 스타일링 */
        .leaflet-control-zoom a {
            background-color: white;
            color: #2c3e50;
            border: 2px solid #ecf0f1;
        }
        
        .leaflet-control-zoom a:hover {
            background-color: #2c3e50;
            color: white;
        }
        
        .leaflet-popup-content-wrapper {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .leaflet-popup-tip {
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>한국 지역별 데이터 시각화</h1>
    </div>
    
    <div class="container">
        <div class="map-container">
            <div id="loading" class="loading">
                <p>지도 데이터를 불러오는 중...</p>
            </div>
            <div id="map"></div>
        </div>
        
        <div class="sidebar">
            <div class="controls">
                <h4>데이터 설정</h4>
                <div class="control-group">
                    <label for="dataType">데이터 유형:</label>
                    <select id="dataType">
                        <option value="sample">샘플 데이터</option>
                        <option value="population">인구수</option>
                        <option value="economy">경제지수</option>
                        <option value="environment">환경지수</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="colorScheme">색상 스킴:</label>
                    <select id="colorScheme">
                        <option value="blues">블루</option>
                        <option value="greens">그린</option>
                        <option value="reds">레드</option>
                        <option value="oranges">오렌지</option>
                    </select>
                </div>
            </div>
            
            <div class="info-panel">
                <h3>선택된 지역 정보</h3>
                <div id="region-info">
                    <p>지도에서 지역을 클릭하세요.</p>
                </div>
            </div>
            
            <div class="legend">
                <h4>범례</h4>
                <div id="legend-content">
                    <!-- 범례 내용이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // 전역 변수
        let map;
        let geojsonLayer;
        let currentData = {};
        
        // 색상 스킴 정의 (블록 스타일에 맞게 더 선명한 색상)
        const colorSchemes = {
            blues: ['#e3f2fd', '#bbdefb', '#90caf9', '#64b5f6', '#42a5f5', '#2196f3', '#1e88e5', '#1976d2', '#1565c0'],
            greens: ['#e8f5e8', '#c8e6c9', '#a5d6a7', '#81c784', '#66bb6a', '#4caf50', '#43a047', '#388e3c', '#2e7d32'],
            reds: ['#ffebee', '#ffcdd2', '#ef9a9a', '#e57373', '#ef5350', '#f44336', '#e53935', '#d32f2f', '#c62828'],
            oranges: ['#fff3e0', '#ffe0b2', '#ffcc80', '#ffb74d', '#ffa726', '#ff9800', '#fb8c00', '#f57c00', '#ef6c00']
        };
        
        // 샘플 데이터 (실제 데이터로 교체 예정)
        const sampleData = {
            '서울특별시 강남구': 85,
            '서울특별시 강동구': 72,
            '서울특별시 강북구': 68,
            '서울특별시 강서구': 71,
            '서울특별시 관악구': 69,
            '부산광역시 해운대구': 78,
            '부산광역시 부산진구': 73,
            '대구광역시 중구': 65,
            '인천광역시 남동구': 70,
            '광주광역시 서구': 67,
            '대전광역시 서구': 71,
            '울산광역시 남구': 74,
            '경기도 수원시': 76,
            '경기도 성남시': 79,
            '경기도 고양시': 77,
            '강원도 춘천시': 63,
            '충청북도 청주시': 68,
            '충청남도 천안시': 70,
            '전라북도 전주시': 66,
            '전라남도 목포시': 62,
            '경상북도 포항시': 69,
            '경상남도 창원시': 72,
            '제주특별자치도 제주시': 75
        };
        
        // 지도 초기화
        function initMap() {
            map = L.map('map', {
                zoomControl: true,
                scrollWheelZoom: true,
                doubleClickZoom: true,
                boxZoom: true,
                keyboard: true,
                dragging: true,
                touchZoom: true
            }).setView([36.5, 127.5], 7);
            
            // 배경을 단색으로 설정 (타일맵 없이)
            map.getContainer().style.backgroundColor = '#f8f9fa';
        }
        
        // 값에 따른 색상 반환
        function getColor(value, scheme = 'blues') {
            const colors = colorSchemes[scheme];
            const max = Math.max(...Object.values(currentData));
            const min = Math.min(...Object.values(currentData));
            const range = max - min;
            
            if (range === 0) return colors[4];
            
            const normalized = (value - min) / range;
            const index = Math.floor(normalized * (colors.length - 1));
            return colors[Math.max(0, Math.min(index, colors.length - 1))];
        }
        
        // GeoJSON 스타일 함수
        function style(feature) {
            const regionName = feature.properties.CTP_KOR_NM || feature.properties.SIG_KOR_NM || feature.properties.name;
            const value = currentData[regionName] || 0;
            const scheme = document.getElementById('colorScheme').value;
            
            return {
                fillColor: getColor(value, scheme),
                weight: 2,
                opacity: 1,
                color: '#ffffff',
                dashArray: '',
                fillOpacity: 1,
                stroke: true
            };
        }
        
        // 마우스 이벤트 핸들러
        function highlightFeature(e) {
            const layer = e.target;
            
            layer.setStyle({
                weight: 4,
                color: '#2c3e50',
                dashArray: '',
                fillOpacity: 0.9,
                stroke: true
            });
            
            layer.bringToFront();
            
            // 툴팁 표시
            const regionName = layer.feature.properties.CTP_KOR_NM || layer.feature.properties.SIG_KOR_NM || layer.feature.properties.name;
            const value = currentData[regionName] || 0;
            
            const tooltip = L.popup()
                .setLatLng(e.latlng)
                .setContent(`<strong>${regionName}</strong><br>값: ${value}`)
                .openOn(map);
        }
        
        function resetHighlight(e) {
            geojsonLayer.resetStyle(e.target);
        }
        
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
            
            // 사이드바 정보 업데이트
            const regionName = e.target.feature.properties.CTP_KOR_NM || e.target.feature.properties.SIG_KOR_NM || e.target.feature.properties.name;
            const value = currentData[regionName] || 0;
            
            document.getElementById('region-info').innerHTML = `
                <p><strong>지역명:</strong> ${regionName}</p>
                <p><strong>데이터 값:</strong> ${value}</p>
                <p><strong>순위:</strong> ${getRank(value)}</p>
            `;
        }
        
        function getRank(value) {
            const values = Object.values(currentData).sort((a, b) => b - a);
            return values.indexOf(value) + 1;
        }
        
        // 각 feature에 이벤트 리스너 추가
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }
        
        // GeoJSON 데이터 로드
        async function loadGeoJSON() {
            try {
                // 공개된 한국 시군구 GeoJSON 데이터 URL
                const url = 'https://raw.githubusercontent.com/southkorea/southkorea-maps/master/kostat/2018/json/skorea-municipalities-2018-geo.json';
                
                const response = await fetch(url);
                const geoData = await response.json();
                
                // 기존 레이어 제거
                if (geojsonLayer) {
                    map.removeLayer(geojsonLayer);
                }
                
                // 새 레이어 추가
                geojsonLayer = L.geoJSON(geoData, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // 한국 전체가 보이도록 지도 범위 조정
                map.fitBounds(geojsonLayer.getBounds());
                
                // 로딩 표시 제거
                document.getElementById('loading').style.display = 'none';
                
                // 범례 업데이트
                updateLegend();
                
            } catch (error) {
                console.error('GeoJSON 로드 실패:', error);
                document.getElementById('loading').innerHTML = '<p>지도 데이터 로드에 실패했습니다.</p>';
            }
        }
        
        // 범례 업데이트
        function updateLegend() {
            const scheme = document.getElementById('colorScheme').value;
            const colors = colorSchemes[scheme];
            const max = Math.max(...Object.values(currentData));
            const min = Math.min(...Object.values(currentData));
            const range = max - min;
            
            const legendContent = document.getElementById('legend-content');
            legendContent.innerHTML = '';
            
            // 색상별 범례 생성
            for (let i = colors.length - 1; i >= 0; i--) {
                const value = min + (range * i / (colors.length - 1));
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${colors[i]}"></div>
                    <span>${value.toFixed(1)}</span>
                `;
                legendContent.appendChild(legendItem);
            }
        }
        
        // 데이터 업데이트
        function updateData() {
            const dataType = document.getElementById('dataType').value;
            
            // 실제 구현에서는 여기서 외부 데이터를 로드
            currentData = sampleData;
            
            // 지도 스타일 업데이트
            if (geojsonLayer) {
                geojsonLayer.setStyle(style);
            }
            
            // 범례 업데이트
            updateLegend();
        }
        
        // 이벤트 리스너 등록
        document.getElementById('dataType').addEventListener('change', updateData);
        document.getElementById('colorScheme').addEventListener('change', () => {
            if (geojsonLayer) {
                geojsonLayer.setStyle(style);
            }
            updateLegend();
        });
        
        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            currentData = sampleData;
            initMap();
            loadGeoJSON();
        });
    </script>
</body>
</html>